<!DOCTYPE html PUBLIC "-//W3C//DTD XHTML 1.0 Strict//EN"
	"http://www.w3.org/TR/xhtml1/DTD/xhtml1-strict.dtd">
<html xmlns="http://www.w3.org/1999/xhtml">
	<head>
		<meta http-equiv="Content-Type" content="text/html; charset=utf-8" />
		<title>rrregex</title>
		<link rel="stylesheet" href="style.css" type="text/css" media="screen" title="no title" charset="utf-8"></link>
		<script src="http://ajax.googleapis.com/ajax/libs/jquery/1.7.1/jquery.min.js" type="text/javascript"></script>
		<script src="mustache.js" type="text/javascript" charset="utf-8"></script>
		<script type="text/javascript">
//<![CDATA[
		var captures_tmpl = "<span>captures:</span> <ol>{{#captures}}<li>{{.}}<\/li>{{/captures}}<\/ol>"      
		var match_tmpl = "<span>match:</span>{{match}}"
		function do_match() {
			$.ajax({
				type: 'POST',
				url: "match",
				data: encodeURI($("#rrregex").serialize()),
				success: function(data, textStatus, jqXHR) {   
					resp = JSON.parse(data);  
					$("#test").toggleClass("valid", resp.result);
					$("#test").toggleClass("invalid", !resp.result);   
					
					if (resp.result == true) {           
						// display match
						$("#resp_match").html(Mustache.to_html(match_tmpl, resp))
						// display captures
						if (resp.captures != null && resp.captures.length > 0)  {
							$("#resp_captures").html(Mustache.to_html(captures_tmpl, resp));  
						}
					} else {
						if (resp.error) {
							// error message, invalid regex
							$("#resp_match").html(resp.error);
						} else {
							// valid regex, just no match
							$("#resp_match").html('');   
							$("#resp_captures").html('');              
						}   
					}                  
				} // success func
			   }) 
			.error(function(data, textStatus, jqXHR) { 
				alert(data.status + ": " + data.responseText);
			});                                       
		}          
		
		// setup keyboard handlers on all the necessary UI elements
		$(document).ready(function() {  
			$("#test").keyup(function() {
				do_match(); return false;
			 });   
			$("#regex").keyup(function() {
				do_match(); return false; 
			});
			$("#opts").keyup(function() {
				do_match(); return false; 
			});  
		});
		//]]>
		</script>
	</head>
	<body>
		<form id="rrregex">
			<span>(ruby) regular expression:</span>
			<div>
				<span>/ </span>
				<input type="text" name="regex" id="regex" value="[a-d].*" size="100" /> 
				<span>/</span> 
				<input type="text" name="opts" id="opts" size="4" value="" />
			</div>
			<br />
			<div style="float:left;">
				<span>test string:</span>
				<div>
					<textarea name="test" id="test" cols="50" rows="10" style="outline:none;"></textarea>
				</div>
			</div>
			<div id="resp" style="float:left;">
			   
				<div id="resp_match"></div>
				<div id="resp_captures"></div>
			</div>
		</form>
	</body>
</html>
